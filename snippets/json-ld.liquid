{% comment %}
  JSON-LD Structured Data
  Schema.org markup for rich search results
  
  Include in theme.liquid before </head>:
  {% render 'json-ld' %}
  
  Schemas included:
  - Organization
  - WebSite with SearchAction
  - BreadcrumbList
  - Product with AggregateOffer
  - Article
  - CollectionPage with ItemList
  - FAQPage
  - LocalBusiness (optional)
  - VideoObject (for product videos)
{% endcomment %}

{%- comment -%} Organization Schema {%- endcomment -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "@id": "{{ shop.url }}#organization",
  "name": {{ shop.name | json }},
  "url": {{ shop.url | json }},
  {%- if settings.logo != blank -%}
  "logo": {
    "@type": "ImageObject",
    "url": {{ settings.logo | image_url: width: 500 | json }},
    "width": 500,
    "height": 500
  },
  {%- endif -%}
  {%- if shop.phone != blank -%}
  "telephone": {{ shop.phone | json }},
  {%- endif -%}
  {%- if shop.email != blank -%}
  "email": {{ shop.email | json }},
  {%- endif -%}
  {%- if settings.business_description != blank -%}
  "description": {{ settings.business_description | json }},
  {%- endif -%}
  "sameAs": [
    {%- if settings.social_facebook != blank -%}{{ settings.social_facebook | json }},{%- endif -%}
    {%- if settings.social_instagram != blank -%}{{ settings.social_instagram | json }},{%- endif -%}
    {%- if settings.social_twitter != blank -%}{{ settings.social_twitter | json }},{%- endif -%}
    {%- if settings.social_youtube != blank -%}{{ settings.social_youtube | json }},{%- endif -%}
    {%- if settings.social_linkedin != blank -%}{{ settings.social_linkedin | json }},{%- endif -%}
    {%- if settings.social_tiktok != blank -%}{{ settings.social_tiktok | json }}{%- endif -%}
  ],
  "contactPoint": {
    "@type": "ContactPoint",
    "contactType": "customer service",
    {%- if shop.email != blank -%}
    "email": {{ shop.email | json }},
    {%- endif -%}
    {%- if shop.phone != blank -%}
    "telephone": {{ shop.phone | json }},
    {%- endif -%}
    "availableLanguage": {{ request.locale.iso_code | json }}
  }
}
</script>

{%- comment -%} WebSite Schema with SearchAction {%- endcomment -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": {{ shop.name | json }},
  "url": {{ shop.url | json }},
  "potentialAction": {
    "@type": "SearchAction",
    "target": {
      "@type": "EntryPoint",
      "urlTemplate": "{{ shop.url }}/search?q={search_term_string}"
    },
    "query-input": "required name=search_term_string"
  }
}
</script>

{%- comment -%} BreadcrumbList Schema {%- endcomment -%}
{%- unless template.name == 'index' -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": {{ shop.url | json }}
    }
    {%- case template.name -%}
      {%- when 'product' -%}
        {%- if product.collections.first -%}
        ,{
          "@type": "ListItem",
          "position": 2,
          "name": {{ product.collections.first.title | json }},
          "item": {{ product.collections.first.url | prepend: shop.url | json }}
        }
        ,{
          "@type": "ListItem",
          "position": 3,
          "name": {{ product.title | json }},
          "item": {{ product.url | prepend: shop.url | json }}
        }
        {%- else -%}
        ,{
          "@type": "ListItem",
          "position": 2,
          "name": {{ product.title | json }},
          "item": {{ product.url | prepend: shop.url | json }}
        }
        {%- endif -%}
      {%- when 'collection' -%}
        ,{
          "@type": "ListItem",
          "position": 2,
          "name": {{ collection.title | json }},
          "item": {{ collection.url | prepend: shop.url | json }}
        }
      {%- when 'article' -%}
        ,{
          "@type": "ListItem",
          "position": 2,
          "name": {{ blog.title | json }},
          "item": {{ blog.url | prepend: shop.url | json }}
        }
        ,{
          "@type": "ListItem",
          "position": 3,
          "name": {{ article.title | json }},
          "item": {{ article.url | prepend: shop.url | json }}
        }
      {%- when 'blog' -%}
        ,{
          "@type": "ListItem",
          "position": 2,
          "name": {{ blog.title | json }},
          "item": {{ blog.url | prepend: shop.url | json }}
        }
      {%- when 'page' -%}
        ,{
          "@type": "ListItem",
          "position": 2,
          "name": {{ page.title | json }},
          "item": {{ page.url | prepend: shop.url | json }}
        }
    {%- endcase -%}
  ]
}
</script>
{%- endunless -%}

{%- comment -%} Product Schema {%- endcomment -%}
{%- if template.name == 'product' -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Product",
  "name": {{ product.title | json }},
  "url": {{ product.url | prepend: shop.url | json }},
  "description": {{ product.description | strip_html | truncate: 5000 | json }},
  {%- if product.featured_image -%}
  "image": [
    {%- for image in product.images limit: 5 -%}
    {{ image | image_url: width: 1200 | json }}{% unless forloop.last %},{% endunless %}
    {%- endfor -%}
  ],
  {%- endif -%}
  {%- if product.vendor != blank -%}
  "brand": {
    "@type": "Brand",
    "name": {{ product.vendor | json }}
  },
  {%- endif -%}
  {%- if product.sku != blank -%}
  "sku": {{ product.selected_or_first_available_variant.sku | json }},
  {%- endif -%}
  {%- if product.barcode != blank -%}
  "gtin": {{ product.selected_or_first_available_variant.barcode | json }},
  {%- endif -%}
  "offers": {
    "@type": "AggregateOffer",
    "priceCurrency": {{ cart.currency.iso_code | json }},
    "lowPrice": {{ product.price_min | money_without_currency | json }},
    "highPrice": {{ product.price_max | money_without_currency | json }},
    "offerCount": {{ product.variants.size }},
    {%- if product.available -%}
    "availability": "https://schema.org/InStock",
    {%- else -%}
    "availability": "https://schema.org/OutOfStock",
    {%- endif -%}
    "url": {{ product.url | prepend: shop.url | json }},
    "seller": {
      "@type": "Organization",
      "name": {{ shop.name | json }}
    }
  }
  {%- comment -%} Add review data if available {%- endcomment -%}
}
</script>
{%- endif -%}

{%- comment -%} Article Schema {%- endcomment -%}
{%- if template.name == 'article' -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": {{ article.title | json }},
  "url": {{ article.url | prepend: shop.url | json }},
  "description": {{ article.excerpt_or_content | strip_html | truncate: 200 | json }},
  {%- if article.image -%}
  "image": {{ article.image | image_url: width: 1200 | json }},
  {%- endif -%}
  "datePublished": {{ article.published_at | date: '%Y-%m-%dT%H:%M:%S%z' | json }},
  "dateModified": {{ article.updated_at | date: '%Y-%m-%dT%H:%M:%S%z' | json }},
  "author": {
    "@type": "Person",
    "name": {{ article.author | json }}
  },
  "publisher": {
    "@type": "Organization",
    "name": {{ shop.name | json }},
    {%- if settings.logo != blank -%}
    "logo": {
      "@type": "ImageObject",
      "url": {{ settings.logo | image_url: width: 500 | json }}
    },
    {%- endif -%}
    "url": {{ shop.url | json }}
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": {{ article.url | prepend: shop.url | json }}
  }
}
</script>
{%- endif -%}

{%- comment -%} Collection Schema {%- endcomment -%}
{%- if template.name == 'collection' -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "CollectionPage",
  "name": {{ collection.title | json }},
  "url": {{ collection.url | prepend: shop.url | json }},
  "description": {{ collection.description | strip_html | truncate: 200 | json }},
  {%- if collection.image -%}
  "image": {{ collection.image | image_url: width: 1200 | json }},
  {%- endif -%}
  "numberOfItems": {{ collection.products_count }}
}
</script>
{%- endif -%}

{%- comment -%} Local Business Schema (if applicable) {%- endcomment -%}
{%- if settings.enable_local_business_schema -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "LocalBusiness",
  "name": {{ shop.name | json }},
  "url": {{ shop.url | json }},
  {%- if settings.logo != blank -%}
  "image": {{ settings.logo | image_url: width: 500 | json }},
  {%- endif -%}
  {%- if shop.phone != blank -%}
  "telephone": {{ shop.phone | json }},
  {%- endif -%}
  {%- if shop.email != blank -%}
  "email": {{ shop.email | json }},
  {%- endif -%}
  {%- if settings.business_address != blank -%}
  "address": {
    "@type": "PostalAddress",
    "streetAddress": {{ settings.business_street | json }},
    "addressLocality": {{ settings.business_city | json }},
    "addressRegion": {{ settings.business_state | json }},
    "postalCode": {{ settings.business_zip | json }},
    "addressCountry": {{ settings.business_country | json }}
  },
  {%- endif -%}
  "priceRange": "$$"
}
</script>
{%- endif -%}

{%- comment -%} FAQ Schema (for FAQ pages) {%- endcomment -%}
{%- if template.suffix == 'faq' -%}
  {%- assign faq_items = page.content | split: '<h3>' -%}
  {%- if faq_items.size > 1 -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {%- for item in faq_items offset: 1 -%}
      {%- assign question = item | split: '</h3>' | first | strip_html -%}
      {%- assign answer = item | split: '</h3>' | last | strip_html | truncate: 500 -%}
      {%- if question != blank and answer != blank -%}
    {
      "@type": "Question",
      "name": {{ question | json }},
      "acceptedAnswer": {
        "@type": "Answer",
        "text": {{ answer | json }}
      }
    }{% unless forloop.last %},{% endunless %}
      {%- endif -%}
    {%- endfor -%}
  ]
}
</script>
  {%- endif -%}
{%- endif -%}

{%- comment -%} ItemList Schema for Collection Products {%- endcomment -%}
{%- if template.name == 'collection' and collection.products.size > 0 -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "ItemList",
  "name": {{ collection.title | json }},
  "description": {{ collection.description | strip_html | truncate: 200 | json }},
  "url": {{ collection.url | prepend: shop.url | json }},
  "numberOfItems": {{ collection.products_count }},
  "itemListElement": [
    {%- for product in collection.products limit: 20 -%}
    {
      "@type": "ListItem",
      "position": {{ forloop.index }},
      "item": {
        "@type": "Product",
        "name": {{ product.title | json }},
        "url": {{ product.url | prepend: shop.url | json }},
        {%- if product.featured_image -%}
        "image": {{ product.featured_image | image_url: width: 800 | json }},
        {%- endif -%}
        "offers": {
          "@type": "Offer",
          "price": {{ product.price | money_without_currency | json }},
          "priceCurrency": {{ cart.currency.iso_code | json }},
          "availability": "{% if product.available %}https://schema.org/InStock{% else %}https://schema.org/OutOfStock{% endif %}"
        }
      }
    }{% unless forloop.last %},{% endunless %}
    {%- endfor -%}
  ]
}
</script>
{%- endif -%}

{%- comment -%} VideoObject Schema for Product Videos {%- endcomment -%}
{%- if template.name == 'product' -%}
  {%- for media in product.media -%}
    {%- if media.media_type == 'video' or media.media_type == 'external_video' -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "VideoObject",
  "name": {{ product.title | append: ' - Video' | json }},
  "description": {{ product.description | strip_html | truncate: 200 | json }},
  {%- if media.media_type == 'video' -%}
  "contentUrl": {{ media.sources[0].url | json }},
  "thumbnailUrl": {{ media.preview_image | image_url: width: 800 | json }},
  "duration": "PT{{ media.duration | divided_by: 1000 }}S",
  {%- elsif media.media_type == 'external_video' -%}
  "embedUrl": "{% if media.host == 'youtube' %}https://www.youtube.com/embed/{{ media.external_id }}{% elsif media.host == 'vimeo' %}https://player.vimeo.com/video/{{ media.external_id }}{% endif %}",
  "thumbnailUrl": {{ media.preview_image | image_url: width: 800 | json }},
  {%- endif -%}
  "uploadDate": {{ product.created_at | date: '%Y-%m-%dT%H:%M:%S%z' | json }}
}
</script>
      {%- break -%}
    {%- endif -%}
  {%- endfor -%}
{%- endif -%}

{%- comment -%} HowTo Schema for Training Pages {%- endcomment -%}
{%- if template.suffix == 'training' and page.content contains '<h3>' -%}
  {%- assign steps = page.content | split: '<h3>' -%}
  {%- if steps.size > 1 -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "HowTo",
  "name": {{ page.title | json }},
  "description": {{ page.content | strip_html | truncate: 200 | json }},
  "step": [
    {%- for step in steps offset: 1 -%}
      {%- assign step_name = step | split: '</h3>' | first | strip_html -%}
      {%- assign step_text = step | split: '</h3>' | last | strip_html | truncate: 300 -%}
      {%- if step_name != blank -%}
    {
      "@type": "HowToStep",
      "position": {{ forloop.index }},
      "name": {{ step_name | json }},
      "text": {{ step_text | json }}
    }{% unless forloop.last %},{% endunless %}
      {%- endif -%}
    {%- endfor -%}
  ]
}
</script>
  {%- endif -%}
{%- endif -%}

{%- comment -%} SiteNavigationElement Schema {%- endcomment -%}
{%- if template.name == 'index' -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "SiteNavigationElement",
  "name": "Main Navigation",
  "url": {{ shop.url | json }}
}
</script>
{%- endif -%}
